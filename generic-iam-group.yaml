AWSTemplateFormatVersion: 2010-09-09
Description: Template to create new IAM Groups consiting of managed policies

Parameters:
  GroupName:
    Type: String
    Description: The name of the new IAM Group

Resources:

  IAMGroup:
    Type: AWS::IAM::Group
    Properties:
      GroupName: !Ref GroupName
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/AdministratorAccess

  AdminUser:
    Type: AWS::IAM::User
    Properties:
      UserName: admin
      LoginProfile:
        Password: '{{resolve:secretsmanager:admin-temporary-password}}'
        PasswordResetRequired: true
      Tags:
        - Key: client
          Value: chinatown
        - Key: description
          Value: admin created after initial account creation to prevent the need for the root acount login
        - Key: created-by
          Value: Austin Conder

  AddAdminToGroup:
    Type: AWS::IAM::UserToGroupAddition
    Properties:
      GroupName: !Ref AdminsGroup
      Users:
        - !Ref AdminUser
